<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Professional Calculator</title>
    <link rel="stylesheet" href="styles/reset.css" />
    <link rel="stylesheet" href="styles/theme.css" />
    <link rel="stylesheet" href="styles/layout.css" />
    <link rel="stylesheet" href="styles/components.css" />
  </head>
  <body>
    <main class="calculator-container">
      <div class="calculator">
        <section class="display-section">
          <div class="display">
            <div class="previous-operand" id="previous-operand"></div>
            <div class="current-operand" id="current-operand">0</div>
          </div>
        </section>

        <section class="controls-section">
          <div class="button-row">
            <button class="btn btn-clear" data-action="clear">AC</button>
            <button class="btn btn-delete" data-action="delete">⌫</button>
            <button class="btn btn-operator" data-operator="/">÷</button>
            <button class="btn btn-operator" data-operator="*">×</button>
          </div>

          <div class="button-row">
            <button class="btn btn-number" data-number="7">7</button>
            <button class="btn btn-number" data-number="8">8</button>
            <button class="btn btn-number" data-number="9">9</button>
            <button class="btn btn-operator" data-operator="-">−</button>
          </div>

          <div class="button-row">
            <button class="btn btn-number" data-number="4">4</button>
            <button class="btn btn-number" data-number="5">5</button>
            <button class="btn btn-number" data-number="6">6</button>
            <button class="btn btn-operator" data-operator="+">+</button>
          </div>

          <div class="button-row">
            <button class="btn btn-number" data-number="1">1</button>
            <button class="btn btn-number" data-number="2">2</button>
            <button class="btn btn-number" data-number="3">3</button>
            <button class="btn btn-equals btn-tall" data-action="equals">
              =
            </button>
          </div>

          <div class="button-row">
            <button class="btn btn-number btn-wide" data-number="0">0</button>
            <button class="btn btn-number" data-number=".">.</button>
          </div>
        </section>
      </div>
    </main>

    <script>
      class Calculator {
        constructor() {
          this.currentOperand = "0";
          this.previousOperand = "";
          this.operation = null;
          this.shouldResetScreen = false;

          this.currentOperandElement =
            document.getElementById("current-operand");
          this.previousOperandElement =
            document.getElementById("previous-operand");

          this.bindEvents();
        }

        bindEvents() {
          document.addEventListener("click", (e) => {
            if (e.target.matches("[data-number]")) {
              this.appendNumber(e.target.dataset.number);
              this.updateDisplay();
            }
            if (e.target.matches("[data-operator]")) {
              this.chooseOperation(e.target.dataset.operator);
              this.updateDisplay();
            }
            if (e.target.matches('[data-action="equals"]')) {
              this.compute();
              this.updateDisplay();
            }
            if (e.target.matches('[data-action="clear"]')) {
              this.clear();
              this.updateDisplay();
            }
            if (e.target.matches('[data-action="delete"]')) {
              this.delete();
              this.updateDisplay();
            }
          });

          document.addEventListener("keydown", (e) => {
            if ((e.key >= "0" && e.key <= "9") || e.key === ".") {
              this.appendNumber(e.key);
              this.updateDisplay();
            }
            if (
              e.key === "+" ||
              e.key === "-" ||
              e.key === "*" ||
              e.key === "/"
            ) {
              this.chooseOperation(e.key);
              this.updateDisplay();
            }
            if (e.key === "Enter" || e.key === "=") {
              this.compute();
              this.updateDisplay();
            }
            if (e.key === "Escape") {
              this.clear();
              this.updateDisplay();
            }
            if (e.key === "Backspace") {
              this.delete();
              this.updateDisplay();
            }
          });
        }

        appendNumber(number) {
          if (number === "." && this.currentOperand.includes(".")) return;
          if (this.shouldResetScreen) {
            this.currentOperand = "";
            this.shouldResetScreen = false;
          }
          if (this.currentOperand === "0" && number !== ".") {
            this.currentOperand = number;
          } else {
            this.currentOperand += number;
          }
        }

        chooseOperation(operation) {
          if (this.currentOperand === "") return;
          if (this.previousOperand !== "") {
            this.compute();
          }
          this.operation = operation;
          this.previousOperand = this.currentOperand;
          this.currentOperand = "";
        }

        compute() {
          let computation;
          const prev = parseFloat(this.previousOperand);
          const current = parseFloat(this.currentOperand);

          if (isNaN(prev) || isNaN(current)) return;

          switch (this.operation) {
            case "+":
              computation = prev + current;
              break;
            case "-":
              computation = prev - current;
              break;
            case "*":
              computation = prev * current;
              break;
            case "/":
              if (current === 0) {
                alert("Cannot divide by zero");
                return;
              }
              computation = prev / current;
              break;
            default:
              return;
          }

          this.currentOperand = computation.toString();
          this.operation = null;
          this.previousOperand = "";
          this.shouldResetScreen = true;
        }

        clear() {
          this.currentOperand = "0";
          this.previousOperand = "";
          this.operation = null;
        }

        delete() {
          if (this.currentOperand.length <= 1) {
            this.currentOperand = "0";
          } else {
            this.currentOperand = this.currentOperand.slice(0, -1);
          }
        }

        updateDisplay() {
          this.currentOperandElement.textContent = this.currentOperand;
          if (this.operation != null) {
            this.previousOperandElement.textContent = `${this.previousOperand} ${this.operation}`;
          } else {
            this.previousOperandElement.textContent = "";
          }
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        new Calculator();
      });
    </script>
  </body>
</html>
